<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã³ã™ã“ãƒªãƒ¼ã‚°äºˆæƒ³</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-predict.png">
<link rel="apple-touch-icon" href="icon-predict.png">
<meta name="theme-color" content="#ffffff">

<style>
  :root {
    --primary: #007BFF; /* æ°´è‰² */
    --inactive: #AAAAAA; /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
    --header-bg: #333333; /* æ¿ƒã„ã‚°ãƒ¬ãƒ¼ */
    --bg-color: #F4F4F9;
    --filter-primary: invert(42%) sepia(93%) saturate(1352%) hue-rotate(200deg) brightness(100%) contrast(100%);
    --filter-inactive: invert(67%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(85%);
  }

  html, body { margin: 0; height: 100%; background: var(--bg-color); font-family: sans-serif; color: #333; overflow: hidden; }

  /* ===== ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢ ===== */
  #splash{
    position:fixed; inset:0; background:#ffffff;
    display:flex; justify-content:center; align-items:center;
    z-index:9999; transition:opacity 0.6s ease;
  }
  #logo-anim{ position:relative; width:800px; height:800px; max-width:60vw; max-height:60vw; }
  .part{ position:absolute; top:0; left:0; width:100%; opacity:0; }
  .leftL{ animation:leftIn 0.8s ease forwards; }
  .three{ animation:threeIn 0.8s ease 0.6s forwards; }
  .rightL{ animation:rightIn 0.8s ease 1.3s forwards; }
  .text{ transform:scaleX(0); transform-origin:left center; animation:textExpand 0.8s cubic-bezier(.65,0,.35,1) 1.8s forwards; }
  @keyframes leftIn{ from{transform:translateY(80px);opacity:0;} to{transform:translateY(0);opacity:1;} }
  @keyframes threeIn{ from{transform:translateY(-80px);opacity:0;} to{transform:translateY(0);opacity:1;} }
  @keyframes rightIn{ from{opacity:0;transform:scale(0.9);} to{opacity:1;transform:scale(1);} }
  @keyframes textExpand{ to{opacity:1;transform:scaleX(1);} }

  /* ===== èªè¨¼ç”»é¢ (Login/Register) ===== */
  #auth-container {
    position: fixed; inset: 0; background: var(--bg-color);
    z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;
  }
  .auth-card { background: white; width: 100%; max-width: 350px; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  .auth-card h2 { margin-top: 0; color: var(--header-bg); text-align: center; }
  input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

  /* ===== ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
  .header {
    background: var(--header-bg); color: white; padding: 10px 15px;
    display: flex; justify-content: space-between; align-items: center;
    position: fixed; top: 0; width: 100%; height: 50px; box-sizing: border-box; z-index: 1000;
  }
  .header-left { font-weight: bold; font-size: 1.1rem; }
  .header-right { display: flex; align-items: center; gap: 8px; }
  .bell-icon { width: 22px; height: 22px; filter: invert(100%); cursor: pointer; }

  .content-area {
    margin-top: 50px; margin-bottom: 60px;
    height: calc(100vh - 110px); overflow-y: auto;
    padding: 15px; box-sizing: border-box;
  }
  .page { display: none; }
  .page.active { display: block; }
  .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
  h3 { margin: 0 0 10px 0; font-size: 1rem; color: #555; }

  .sub-tabs { display: flex; gap: 5px; margin-bottom: 15px; background: #eee; padding: 4px; border-radius: 10px; }
  .sub-tab { flex: 1; text-align: center; padding: 8px; border-radius: 7px; font-size: 0.85rem; color: #666; cursor: pointer; }
  .sub-tab.active { background: white; color: var(--primary); font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

  .bottom-tab-bar {
    position: fixed; bottom: 0; width: 100%; height: 60px;
    background: white; display: flex; justify-content: space-around;
    align-items: center; border-top: 1px solid #ddd; z-index: 1000;
  }
  .tab-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--inactive); font-size: 0.7rem; cursor: pointer; }
  .tab-item.active { color: var(--primary); }
  .tab-item img { width: 24px; height: 24px; margin-bottom: 2px; filter: var(--filter-inactive); }
  .tab-item.active img { filter: var(--filter-primary); }

  .btn-main { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
  .btn-sub { background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
  .hidden { display: none !important; }
</style>
</head>

<body>

<div id="splash">
  <div id="logo-anim">
    <img src="blueL-left.svg" class="part leftL">
    <img src="three.svg" class="part three">
    <img src="blueL-right.svg" class="part rightL">
    <img src="text.svg" class="part text">
  </div>
</div>

<div id="auth-container" class="hidden">
  <div class="auth-card" id="login-form">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <input type="text" id="login-username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
    <input type="password" id="login-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button class="btn-main" onclick="onLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <p style="text-align:center; font-size:0.8rem; margin-top:15px; color:#666;" onclick="toggleAuth(true)">æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰</p>
  </div>
  <div class="auth-card hidden" id="register-form">
    <h2>æ–°è¦ç™»éŒ²</h2>
    <input type="text" id="reg-username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å (8æ–‡å­—ä»¥å†…)" maxlength="8">
    <input type="password" id="reg-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <input type="text" id="reg-hint" placeholder="ç§˜å¯†ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰">
    <button class="btn-main" onclick="onRegister()">ç™»éŒ²</button>
    <p style="text-align:center; font-size:0.8rem; margin-top:15px; color:#666;" onclick="toggleAuth(false)">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</p>
  </div>
</div>

<div id="main-app" class="hidden">
  <header class="header">
    <div class="header-left">ã³ã™ã“ãƒªãƒ¼ã‚°</div>
    <div class="header-right">
      <span id="display-user-name">ã•ã‚“</span>
      <img src="icon-notice.svg" class="bell-icon">
    </div>
  </header>

  <div class="content-area">
    <div id="page-home" class="page active">
      <div class="card"><h3>ğŸ“¢ ãŠçŸ¥ã‚‰ã›</h3><div id="home-news">èª­ã¿è¾¼ã¿ä¸­...</div></div>
      <div class="card"><h3>ğŸ¯ å‹Ÿé›†çŠ¶æ³</h3><div id="home-status">èª­ã¿è¾¼ã¿ä¸­...</div></div>
    </div>

    <div id="page-league" class="page">
      <div class="sub-tabs">
        <div class="sub-tab active" onclick="switchSubTab(event, 'league-predict')">äºˆæƒ³æå‡º</div>
        <div class="sub-tab" onclick="switchSubTab(event, 'league-event')">äºˆé¸å‚åŠ </div>
      </div>
      <div id="league-predict" class="sub-page">æå‡ºãƒ•ã‚©ãƒ¼ãƒ èª­è¾¼ä¸­...</div>
      <div id="league-event" class="sub-page hidden">ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±èª­è¾¼ä¸­...</div>
    </div>

    <div id="page-data" class="page">
      <div class="sub-tabs">
        <div class="sub-tab active">8é€±çµ±è¨ˆ</div>
        <div class="sub-tab">8é€±æ²è¼‰é †</div>
        <div class="sub-tab">ã¿ã‚“ãªã®äºˆæƒ³</div>
      </div>
      <div class="card">çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>

    <div id="page-qa" class="page">
      <div class="card"><h3>ğŸ“ å•ã„åˆã‚ã›</h3><textarea id="qa-content" placeholder="å†…å®¹ã‚’å…¥åŠ›"></textarea><button class="btn-main">é€ä¿¡</button></div>
      <div class="card"><h3>ğŸ“‹ éå»ã®å•ã„åˆã‚ã›</h3><div id="qa-list">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div></div>
    </div>

    <div id="page-mypage" class="page">
      <div class="card"><h3>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h3><div id="user-info-detail"></div><button class="btn-sub" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button></div>
      <div class="card"><h3>ğŸ“Š éå»ã®æˆç¸¾</h3><button class="btn-main">ä¸€è¦§ã‚’è¡¨ç¤º</button></div>
    </div>
  </div>

  <nav class="bottom-tab-bar">
    <div class="tab-item active" onclick="switchPage('home')"><img src="icon-home.svg"><span>Home</span></div>
    <div class="tab-item" onclick="switchPage('league')"><img src="icon-league.svg"><span>League</span></div>
    <div class="tab-item" onclick="switchPage('data')"><img src="icon-data.svg"><span>Data</span></div>
    <div class="tab-item" onclick="switchPage('qa')"><img src="icon-q&a.svg"><span>Q&A</span></div>
    <div class="tab-item" onclick="switchPage('mypage')"><img src="icon-mypage.svg"><span>My Page</span></div>
  </nav>
</div>

<script>
  let currentUser = JSON.parse(localStorage.getItem('bisco_user'));

  // 1. ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ & åˆæœŸåŒ–
  window.addEventListener("load", () => {
    setTimeout(() => {
      document.getElementById("splash").style.opacity = "0";
      setTimeout(() => {
        document.getElementById("splash").style.display = "none";
        if (currentUser) {
          showApp();
        } else {
          document.getElementById("auth-container").classList.remove("hidden");
        }
      }, 600);
    }, 3000);
  });

  function showApp() {
    document.getElementById("auth-container").classList.add("hidden");
    document.getElementById("main-app").classList.remove("hidden");
    document.getElementById("display-user-name").innerText = currentUser.name + " ã•ã‚“";
    loadHomeData();
  }

  // 2. èªè¨¼å‡¦ç†
  function toggleAuth(isReg) {
    document.getElementById("login-form").classList.toggle("hidden", isReg);
    document.getElementById("register-form").classList.toggle("hidden", !isReg);
  }

  function onLogin() {
    const u = document.getElementById("login-username").value;
    const p = document.getElementById("login-password").value;
    google.script.run.withSuccessHandler(res => {
      currentUser = res;
      localStorage.setItem('bisco_user', JSON.stringify(res));
      showApp();
    }).withFailureHandler(e => alert(e.message)).login(u, p);
  }

  function onRegister() {
    const u = document.getElementById("reg-username").value;
    const p = document.getElementById("reg-password").value;
    const h = document.getElementById("reg-hint").value;
    google.script.run.withSuccessHandler(res => {
      alert(res.message);
      toggleAuth(false);
    }).withFailureHandler(e => alert(e.message)).registerUser(u, p, h);
  }

  // 3. ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
  function switchPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
    document.getElementById('page-' + pageId).classList.add('active');
    event.currentTarget.classList.add('active');
    if(pageId === 'home') loadHomeData();
  }

  function switchSubTab(e, subPageId) {
    document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.sub-page').forEach(p => p.classList.add('hidden'));
    e.currentTarget.classList.add('active');
    document.getElementById(subPageId).classList.remove('hidden');
  }

  // 4. ãƒ‡ãƒ¼ã‚¿å–å¾— (Home)
  function loadHomeData() {
    google.script.run.withSuccessHandler(data => {
      document.getElementById('home-news').innerText = data.news;
      document.getElementById('home-status').innerHTML = `
        <strong>${data.issueName}</strong><br>
        æå‡ºçŠ¶æ³: ${data.hasSubmitted ? 'âœ… æå‡ºæ¸ˆã¿' : 'âš ï¸ æœªæå‡º'}<br>
        å—ä»˜çŠ¶æ…‹: ${data.isOpen ? 'OPEN' : 'CLOSED'}
      `;
    }).getMyPageData(currentUser.id, currentUser.name);
  }

  function logout() {
    localStorage.clear();
    location.reload();
  }
</script>

</body>
</html>
